<div class="game-container" *ngIf="roomCode">
  <div class="game-header">
    <div class="header-left">
      <h1>Room: {{ roomCode }}</h1>
      <div class="opponent-info">
        Opponent: {{ opponentUsername }}
      </div>
    </div>
    <div class="header-center">
      <div class="scores">
        <span>Wins: {{ playerWins }}</span>
        <span>Losses: {{ playerLosses }}</span>
      </div>
    </div>
    <div class="header-right">
      <button (click)="resign()">Resign</button>
      <button (click)="showCommands = !showCommands">Commands</button>
    </div>
  </div>

  <div class="game-area">
    <app-chessboard
      #chessboard
      [playerColor]="playerColor"
      [customCooldowns]="customCooldowns"
      [sharedCooldowns]="sharedCooldowns">
    </app-chessboard>
    <app-move-queue
      [moveQueue]="moveQueue"
      [playerColor]="playerColor"
      (moveReordered)="onMoveReordered($event)"
      (moveCancelled)="onMoveCancelled($event)">
    </app-move-queue>
  </div>

  <div class="command-input-container">
    <input type="text" placeholder="Enter command..." #commandInput (keyup.enter)="executeCommand(commandInput.value)"/>
    <button (click)="executeCommand(commandInput.value)">Submit</button>
  </div>
  <div *ngIf="commandError" class="error-message">{{ commandError }}</div>

  <div class="commands" *ngIf="showCommands">
    <h3>Commands</h3>
    <h4>Filters (Piece Selection)</h4>
    <ul>
      <li><strong>Piece Type:</strong> `p`, `r`, `n`, `b`, `q`, `k` (e.g., `p->a3` for pawn to a3)</li>
      <li><strong>Rank:</strong> `1` to `8` (e.g., `2->a3` for any piece on rank 2 to a3)</li>
      <li><strong>File:</strong> `A` to `H` (e.g., `A->a3` for any piece on file A to a3)</li>
      <li><strong>All Pieces:</strong> `*` (e.g., `*->a3` for any piece to a3)</li>
      <li><strong>Combine Filters:</strong> Use `&` (AND) and `|` (OR) (e.g., `p&A->a3` for pawns on file A to a3)</li>
    </ul>
    <h4>Actions (Movement)</h4>
    <ul>
      <li><strong>Move to Square:</strong> `d4` (e.g., `p->d4`)</li>
      <li><strong>Multiple Moves:</strong> Use `|` (OR) (e.g., `p->d4|e4` for pawn to d4 or e4)</li>
      <li><strong>Append to Queue:</strong> Use `&` before the action (e.g., `p->&d4` to add move to queue)</li>
      <li><strong>Clear Queue:</strong> `X` (e.g., `p->X` to clear all queued moves for pawns)</li>
    </ul>
    <h4>Examples</h4>
    <ul>
      <li>`p->a3`: Move a pawn to a3.</li>
      <li>`r&B->d4`: Move a rook on file B to d4.</li>
      <li>`n->&b1|&d2`: Append moves for knights to b1 or d2.</li>
      <li>`*->X`: Clear all queues for all pieces.</li>
      <li>`p->X|c3`: Clear all queues for pawns, then move a pawn to c3.</li>
    </ul>
  </div>

  <div class="game-over-overlay" *ngIf="isGameOver">
    <div class="game-over-modal">
      <h2>Game Over</h2>
      <p *ngIf="winner">Winner: {{ winner }}</p>
      <p *ngIf="!winner">Draw</p>
      <button (click)="backToLobby()">Back to Lobby</button>
    </div>
  </div>
</div>

<div *ngIf="!roomCode">
  <p>Loading game...</p>
</div>
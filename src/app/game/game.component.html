<div class="game-container" *ngIf="roomCode">                                                                                        
  <div class="game-header">                                                                                                          
    <div class="header-left">                                                                                                        
      <h1>Room: {{ roomCode }}</h1>                                                                                                  
      <div class="opponent-info">                                                                                                    
        Opponent: {{ opponentUsername }}                                                                                             
      </div>                                                                                                                         
    </div>                                                                                                                           
    <div class="header-center">                                                                                                      
      <div class="scores">                                                                                                           
        <span>Wins: {{ playerWins }}</span>                                                                                          
        <span>Losses: {{ playerLosses }}</span>                                                                                      
      </div>                                                                                                                         
    </div>                                                                                                                           
    <div class="header-right">                                                                                                       
      <button (click)="resign()">Resign</button>                                                                                     
      <button (click)="showCommands = !showCommands">Commands</button>                                                               
    </div>                                                                                                                           
  </div>                                                                                                                             
                                                                                                                                     
  <div class="game-area">
    <div class="board-and-input">
      <app-chessboard
        #chessboard
        [board]="board"
        [playerColor]="playerColor"
        [customCooldowns]="customCooldowns"
        [sharedCooldowns]="sharedCooldowns"
        (moveMade)="onMoveMade($event)">
      </app-chessboard>
      <div class="command-input-container">
        <input type="text" placeholder="Enter command..." #commandInput (keyup.enter)="executeCommand(commandInput.value)"/>
        <button (click)="executeCommand(commandInput.value)">Submit</button>
      </div>
    </div>
    <app-move-queue
      [moveQueue]="moveQueue"
      [board]="board"
      [playerColor]="playerColor"
      (moveReordered)="onMoveReordered($event)"
      (moveCancelled)="onMoveCancelled($event)"
      (clearQueueForPiece)="onClearQueueForPiece($event)">
    </app-move-queue>
  </div>
  <div *ngIf="commandError" class="error-message">{{ commandError }}</div>

  <div class="commands" *ngIf="showCommands">
    <h3>Commands</h3>
    <p>Commands are case-insensitive and spaces are ignored.</p>

    <h4>Filters (Piece Selection)</h4>
    <p>Filters are used to select which pieces a command should apply to. You can combine multiple filters using `&` for AND and `|` for OR.</p>
    <ul>
      <li><strong>Piece Type:</strong> `p` (Pawn), `r` (Rook), `n` (Knight), `b` (Bishop), `q` (Queen), `k` (King).</li>
      <li><strong>File (Column):</strong> `A` through `H`. Must be uppercase.</li>
      <li><strong>Rank (Row):</strong> `1` through `8`.</li>
      <li><strong>All Pieces:</strong> `*` selects all of your pieces.</li>
    </ul>
    <h5>Filter Examples</h5>
    <ul>
      <li>`p` - Selects all of your pawns.</li>
      <li>`A` - Selects all of your pieces on file A.</li>
      <li>`p&A` - Selects all of your pawns on file A.</li>
      <li>`r|n` - Selects all of your rooks and knights.</li>
    </ul>

    <h4>Actions (Movement)</h4>
    <p>Actions define what the selected pieces should do. You can chain multiple actions using `|`.</p>
    <ul>
      <li><strong>Move to Square:</strong> `e4`. Moves the selected piece(s) to the square E4.</li>
      <li><strong>Directional Move:</strong> `u`, `d`, `l`, `r` (up, down, left, right) and combinations like `ul` (up-left). For most pieces, this moves them one square in that direction. For sliding pieces (rook, bishop, queen), you can specify a number of squares, e.g., `2r` to move two squares to the right.</li>
      <li><strong>Knight-Specific Directional Moves:</strong> For knights, two-letter directional commands like `ul` are interpreted as L-shaped moves. The first letter indicates the two-square component of the move, and the second letter indicates the one-square component. For example, `ul` means two squares up and one square left.</li>
      <li><strong>Queue Move:</strong> Prepend an action with `&` to add it to a piece's move queue instead of executing it immediately (e.g., `&e4`). This is useful if the piece is on cooldown.</li>
      <li><strong>Clear Queue:</strong> `X`. Clears all queued moves for the selected piece(s).</li>
    </ul>

    <h4>Full Command Examples</h4>
    <ul>
      <li>`p->e4` - Move a pawn to e4.</li>
      <li>`B->d2` - Move the piece on file B to d2.</li>
      <li>`n->ul` - Move a knight two squares up and one square left.</li>
      <li>`r->&g3|&g4` - Queue moves for a rook to G3 and G4.</li>
      <li>`p&H->X|h5` - Clear the queue for any pawn on file H, then move it to h5.</li>
    </ul>
  </div>                                                                                                                             
                                                                                                                                     
  <div class="game-over-overlay" *ngIf="isGameOver">                                                                                 
    <div class="game-over-modal">                                                                                                    
      <h2>Game Over</h2>                                                                                                             
      <p *ngIf="winner">Winner: {{ winner }}</p>                                                                                     
      <p *ngIf="!winner">Draw</p>                                                                                                    
      <button (click)="backToLobby()">Back to Lobby</button>                                                                         
    </div>                                                                                                                           
  </div>                                                                                                                             
</div>                                                                                                                               
                                                                                                                                     
<div *ngIf="!roomCode">                                                                                                              
  <p>Loading game...</p>                                                                                                             
</div>